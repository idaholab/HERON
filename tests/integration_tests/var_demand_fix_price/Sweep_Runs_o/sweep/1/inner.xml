<?xml version="1.0" ?>
<Simulation verbosity="debug">
	<RunInfo>
		<JobName>Sweep_Runs_i</JobName>
		<WorkingDir>Sweep_Runs_i</WorkingDir>
		<Sequence>read_Speed, print_meta_Speed, arma_sampling, summarize, debug_print</Sequence>
	</RunInfo>
	<Steps>
		<MultiRun name="arma_sampling">
			<Input class="DataObjects" type="PointSet">dispatch_placeholder</Input>
			<Model class="Models" type="EnsembleModel">sample_and_dispatch</Model>
			<Sampler class="Samplers" type="MonteCarlo">mc_arma_dispatch</Sampler>
			<Output class="DataObjects" type="DataSet">arma_samples</Output>
			<Output class="DataObjects" type="DataSet">arma_metrics</Output>
		</MultiRun>
		<PostProcess name="summarize">
			<Input class="DataObjects" type="PointSet">arma_metrics</Input>
			<Model class="Models" type="PostProcessor">average</Model>
			<Output class="DataObjects" type="PointSet">metrics_avg</Output>
			<Output class="OutStreams" type="Print">disp_results</Output>
		</PostProcess>
		<IOStep name="debug_print">
			<Input class="DataObjects" type="PointSet">arma_samples</Input>
			<Output class="OutStreams" type="Print">disp_debug</Output>
		</IOStep>
		<IOStep name="read_Speed">
			<Input class="Files" type="">/ARMA/interpolated.pk</Input>
			<Output class="Models" type="ROM">Speed</Output>
		</IOStep>
		<IOStep name="print_meta_Speed">
			<Input class="Models" type="ROM">Speed</Input>
			<Output class="DataObjects" type="PointSet">Speed_meta</Output>
			<Output class="OutStreams" type="Print">Speed_meta</Output>
		</IOStep>
	</Steps>
	<VariableGroups>
		<Group name="GRO_dispatch">GRO_dispatch_in, GRO_dispatch_out, Time, ClusterTime, Year, Cluster</Group>
		<Group name="GRO_dispatch_in">GRO_dispatch_in_scalar, GRO_dispatch_in_Time</Group>
		<Group name="GRO_dispatch_out">GRO_dispatch_out_Time</Group>
		<Group name="GRO_dispatch_in_scalar">GRO_capacities, scaling</Group>
		<Group name="GRO_dispatch_in_Time">Signal
    </Group>
		<Group name="GRO_dispatch_out_Time">GRO_init_disp</Group>
		<Group name="GRO_armasamples">GRO_armasamples_in, GRO_armasamples_out</Group>
		<Group name="GRO_armasamples_in">GRO_armasamples_in_scalar</Group>
		<Group name="GRO_armasamples_out">GRO_armasamples_out_scalar, GRO_armasamples_out_Time</Group>
		<Group name="GRO_armasamples_in_scalar">scaling, time_delta, GRO_capacities</Group>
		<Group name="GRO_armasamples_out_scalar">NPV</Group>
		<Group name="GRO_armasamples_out_Time">GRO_init_disp</Group>
		<Group name="GRO_final_return">
      mean_NPV, std_NPV, med_NPV, max_NPV, min_NPV,
      perc_5_NPV, perc_95_NPV, samp_NPV, var_NPV
    </Group>
		<Group name="GRO_means">Dispatch__BOP__electricity, Dispatch__Electric_Grid__electricity
    </Group>
		<Group name="GRO_interp">stepwise</Group>
		<Group name="GRO_capacities">BOP_capacity, Electric_Grid_capacity
    </Group>
		<Group name="GRO_init_disp">Dispatch__BOP__electricity, Dispatch__Electric_Grid__electricity
    </Group>
	</VariableGroups>
	<DataObjects>
		<DataSet name="arma_samples">
			<Input>GRO_armasamples_in</Input>
			<Output>GRO_armasamples_out</Output>
			<Index var="ClusterTime">GRO_armasamples_out_Time</Index>
			<Index var="Year">GRO_armasamples_out_Time</Index>
			<Index var="Cluster">GRO_armasamples_out_Time</Index>
		</DataSet>
		<PointSet name="arma_metrics">
			<Output>NPV</Output>
		</PointSet>
		<PointSet name="metrics_avg">
			<Output>GRO_final_return</Output>
		</PointSet>
		<DataSet name="disp_avg">
			<Output>GRO_means</Output>
			<Index var="Time">GRO_means</Index>
			<Index var="Year">GRO_means</Index>
		</DataSet>
		<DataSet name="dispatch_eval">
			<Input>GRO_dispatch_in</Input>
			<Output>GRO_dispatch_out</Output>
			<Index var="Time">GRO_dispatch_in_Time</Index>
			<Index var="ClusterTime">GRO_dispatch_out_Time</Index>
			<Index var="Year">GRO_dispatch_in_Time, GRO_dispatch_out_Time</Index>
			<Index var="Cluster">GRO_dispatch_out_Time</Index>
		</DataSet>
		<PointSet name="dispatch_placeholder">
			<Input>GRO_dispatch_in_scalar</Input>
		</PointSet>
		<DataSet name="Speed_meta"/>
		<PointSet name="Speed_placeholder">
			<Input>scaling</Input>
		</PointSet>
		<DataSet name="Speed_samples">
			<Input>scaling</Input>
			<Output>Signal</Output>
			<Index var="Time">Signal</Index>
			<Index var="Year">Signal</Index>
		</DataSet>
	</DataObjects>
	<Models>
		<ExternalModel ModuleToLoad="/Users/talbpw/projects/heron/src/dispatch.py" name="dispatch" subType="">
			<variables>GRO_dispatch, GRO_armasamples</variables>
		</ExternalModel>
		<EnsembleModel name="sample_and_dispatch" subType="">
			<Model class="Models" type="ExternalModel">
				dispatch
				<Input class="DataObjects" type="PointSet">dispatch_placeholder</Input>
				<TargetEvaluation class="DataObjects" type="DataSet">dispatch_eval</TargetEvaluation>
			</Model>
			<Model class="Models" type="ROM">
				Speed
				<Input class="DataObjects" type="PointSet">Speed_placeholder</Input>
				<TargetEvaluation class="DataObjects" type="DataSet">Speed_samples</TargetEvaluation>
			</Model>
		</EnsembleModel>
		<PostProcessor name="average" subType="BasicStatistics">
			<expectedValue prefix="mean">NPV</expectedValue>
			<sigma prefix="std">NPV</sigma>
			<median prefix="med">NPV</median>
			<maximum prefix="max">NPV</maximum>
			<minimum prefix="min">NPV</minimum>
			<percentile prefix="perc">NPV</percentile>
			<samples prefix="samp">NPV</samples>
			<variance prefix="var">NPV</variance>
		</PostProcessor>
		<ROM name="Speed" subType="pickledROM"/>
	</Models>
	<Files>
		<Input name="libs">egret.lib</Input>
		<Input name="/ARMA/interpolated.pk">interpolated.pk</Input>
	</Files>
	<Samplers>
		<MonteCarlo name="mc_arma_dispatch">
			<samplerInit>
				<initialSeed>42</initialSeed>
				<limit>2</limit>
			</samplerInit>
			<constant name="scaling">1.0</constant>
			<constant name="BOP_capacity">1095.0</constant>
			<constant name="Electric_Grid_capacity">1e+200</constant>
			<constant name="denoises">2</constant>
		</MonteCarlo>
	</Samplers>
	<OutStreams>
		<Print name="disp_debug">
			<type>csv</type>
			<source>arma_samples</source>
		</Print>
		<Print name="disp_results">
			<type>csv</type>
			<source>metrics_avg</source>
		</Print>
		<Print name="Speed_meta">
			<type>csv</type>
			<source>Speed_meta</source>
		</Print>
	</OutStreams>
</Simulation>